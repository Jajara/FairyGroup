
@{
    ViewBag.Title = "PostBuilding";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Droid+Sans:400,700">
<link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Droid+Serif">
<link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Boogaloo">
<link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Economica:700,400italic">

<style type="text/css">
   
    /* css กำหนดความกว้าง ความสูงของแผนที่ */
    #map_canvas {
        width: 100%;
        height: 400px;
        margin: auto;
    }
</style>  

<script type="text/javascript">
    var DataInit;

    //-----------------------------------------------Google Map------------------------------------//
    var geocoder; // กำหนดตัวแปรสำหรับ เก็บ Geocoder Object ใช้แปลงชื่อสถานที่เป็นพิกัด
    var map; // กำหนดตัวแปร map ไว้ด้านนอกฟังก์ชัน เพื่อให้สามารถเรียกใช้งาน จากส่วนอื่นได้
    var my_Marker; // กำหนดตัวแปรสำหรับเก็บตัว marker
    var GGM; // กำหนดตัวแปร GGM ไว้เก็บ google.maps Object จะได้เรียกใช้งานได้ง่ายขึ้น
    function initialize() { // ฟังก์ชันแสดงแผนที่
        GGM = new Object(google.maps); // เก็บตัวแปร google.maps Object ไว้ในตัวแปร GGM
        geocoder = new GGM.Geocoder(); // เก็บตัวแปร google.maps.Geocoder Object
        // กำหนดจุดเริ่มต้นของแผนที่
        var my_Latlng = new GGM.LatLng(13.761728449950002, 100.6527900695800);
        var my_mapTypeId = GGM.MapTypeId.ROADMAP; // กำหนดรูปแบบแผนที่ที่แสดง
        // กำหนด DOM object ที่จะเอาแผนที่ไปแสดง ที่นี้คือ div id=map_canvas
        var my_DivObj = $("#map_canvas")[0];
        // กำหนด Option ของแผนที่
        var myOptions = {
            zoom: 13, // กำหนดขนาดการ zoom
            center: my_Latlng, // กำหนดจุดกึ่งกลาง จากตัวแปร my_Latlng
            mapTypeId: my_mapTypeId // กำหนดรูปแบบแผนที่ จากตัวแปร my_mapTypeId
        };
        map = new GGM.Map(my_DivObj, myOptions); // สร้างแผนที่และเก็บตัวแปรไว้ในชื่อ map

        my_Marker = new GGM.Marker({ // สร้างตัว marker ไว้ในตัวแปร my_Marker
            position: my_Latlng,  // กำหนดไว้ที่เดียวกับจุดกึ่งกลาง
            map: map, // กำหนดว่า marker นี้ใช้กับแผนที่ชื่อ instance ว่า map
            draggable: true, // กำหนดให้สามารถลากตัว marker นี้ได้
            title: "คลิกลากเพื่อหาตำแหน่งจุดที่ต้องการ!" // แสดง title เมื่อเอาเมาส์มาอยู่เหนือ
        });

        // กำหนด event ให้กับตัว marker เมื่อสิ้นสุดการลากตัว marker ให้ทำงานอะไร
        GGM.event.addListener(my_Marker, 'dragend', function () {
            var my_Point = my_Marker.getPosition();  // หาตำแหน่งของตัว marker เมื่อกดลากแล้วปล่อย
            map.panTo(my_Point); // ให้แผนที่แสดงไปที่ตัว marker
            $("#lat_value").val(my_Point.lat());  // เอาค่า latitude ตัว marker แสดงใน textbox id=lat_value
            $("#lon_value").val(my_Point.lng());  // เอาค่า longitude ตัว marker แสดงใน textbox id=lon_value
            $("#zoom_value").val(map.getZoom());  // เอาขนาด zoom ของแผนที่แสดงใน textbox id=zoom_valu
        });

        // กำหนด event ให้กับตัวแผนที่ เมื่อมีการเปลี่ยนแปลงการ zoom
        GGM.event.addListener(map, 'zoom_changed', function () {
            $("#zoom_value").val(map.getZoom());   // เอาขนาด zoom ของแผนที่แสดงใน textbox id=zoom_value
        });

    }
    function searchPlace() { // ฟังก์ชัน สำหรับคันหาสถานที่ ชื่อ searchPlace
        var AddressSearch = $("#namePlace").val();// เอาค่าจาก textbox ที่กรอกมาไว้ในตัวแปร
        if (geocoder) { // ตรวจสอบว่าถ้ามี Geocoder Object
            geocoder.geocode({
                address: AddressSearch // ให้ส่งชื่อสถานที่ไปค้นหา
            }, function (results, status) { // ส่งกลับการค้นหาเป็นผลลัพธ์ และสถานะ
                if (status == GGM.GeocoderStatus.OK) { // ตรวจสอบสถานะ ถ้าหากเจอ
                    var my_Point = results[0].geometry.location; // เอาผลลัพธ์ของพิกัด มาเก็บไว้ที่ตัวแปร
                    map.setCenter(my_Point); // กำหนดจุดกลางของแผนที่ไปที่ พิกัดผลลัพธ์
                    my_Marker.setMap(map); // กำหนดตัว marker ให้ใช้กับแผนที่ชื่อ map
                    my_Marker.setPosition(my_Point); // กำหนดตำแหน่งของตัว marker เท่ากับ พิกัดผลลัพธ์
                    $("#lat_value").val(my_Point.lat());  // เอาค่า latitude พิกัดผลลัพธ์ แสดงใน textbox id=lat_value
                    $("#lon_value").val(my_Point.lng());  // เอาค่า longitude พิกัดผลลัพธ์ แสดงใน textbox id=lon_value
                    //$("#zoom_value").val(map.getZoom()); // เอาขนาด zoom ของแผนที่แสดงใน textbox id=zoom_valu
                } else {
                    // ค้นหาไม่พบแสดงข้อความแจ้ง
                    alert("Geocode was not successful for the following reason: " + status);
                    $("#namePlace").val("");// กำหนดค่า textbox id=namePlace ให้ว่างสำหรับค้นหาใหม่
                }
            });
        }
    }

    $(function () {
        // ส่วนของฟังก์ชันค้นหาชื่อสถานที่ในแผนที่
        //var searchPlace = function () { // ฟังก์ชัน สำหรับคันหาสถานที่ ชื่อ searchPlace
        //    debugger
        //    var AddressSearch = $("#namePlace").val();// เอาค่าจาก textbox ที่กรอกมาไว้ในตัวแปร
        //    if (geocoder) { // ตรวจสอบว่าถ้ามี Geocoder Object
        //        geocoder.geocode({
        //            address: AddressSearch // ให้ส่งชื่อสถานที่ไปค้นหา
        //        }, function (results, status) { // ส่งกลับการค้นหาเป็นผลลัพธ์ และสถานะ
        //            if (status == GGM.GeocoderStatus.OK) { // ตรวจสอบสถานะ ถ้าหากเจอ
        //                var my_Point = results[0].geometry.location; // เอาผลลัพธ์ของพิกัด มาเก็บไว้ที่ตัวแปร
        //                map.setCenter(my_Point); // กำหนดจุดกลางของแผนที่ไปที่ พิกัดผลลัพธ์
        //                my_Marker.setMap(map); // กำหนดตัว marker ให้ใช้กับแผนที่ชื่อ map
        //                my_Marker.setPosition(my_Point); // กำหนดตำแหน่งของตัว marker เท่ากับ พิกัดผลลัพธ์
        //                $("#lat_value").val(my_Point.lat());  // เอาค่า latitude พิกัดผลลัพธ์ แสดงใน textbox id=lat_value
        //                $("#lon_value").val(my_Point.lng());  // เอาค่า longitude พิกัดผลลัพธ์ แสดงใน textbox id=lon_value
        //                //$("#zoom_value").val(map.getZoom()); // เอาขนาด zoom ของแผนที่แสดงใน textbox id=zoom_valu
        //            } else {
        //                // ค้นหาไม่พบแสดงข้อความแจ้ง
        //                alert("Geocode was not successful for the following reason: " + status);
        //                $("#namePlace").val("");// กำหนดค่า textbox id=namePlace ให้ว่างสำหรับค้นหาใหม่
        //            }
        //        });
        //    }
        //}
        $("#SearchPlace").click(function () { // เมื่อคลิกที่ปุ่ม id=SearchPlace ให้ทำงานฟังก์ฃันค้นหาสถานที่
            searchPlace();  // ฟังก์ฃันค้นหาสถานที่
        });
        $("#namePlace").keyup(function (event) { // เมื่อพิมพ์คำค้นหาในกล่องค้นหา
            if (event.keyCode == 13) {  //  ตรวจสอบปุ่มถ้ากด ถ้าเป็นปุ่ม Enter ให้เรียกฟังก์ชันค้นหาสถานที่
                searchPlace();      // ฟังก์ฃันค้นหาสถานที่
            }
        });

    });
    $(function () {
        // โหลด สคริป google map api เมื่อเว็บโหลดเรียบร้อยแล้ว
        // ค่าตัวแปร ที่ส่งไปในไฟล์ google map api
        // v=3.2&sensor=false&language=th&callback=initialize
        //  v เวอร์ชัน่ 3.2
        //  sensor กำหนดให้สามารถแสดงตำแหน่งทำเปิดแผนที่อยู่ได้ เหมาะสำหรับมือถือ ปกติใช้ false
        //  language ภาษา th ,en เป็นต้น
        //  callback ให้เรียกใช้ฟังก์ชันแสดง แผนที่ initialize
        $("<script/>", {
            "type": "text/javascript",
            src: "http://maps.google.com/maps/api/js?v=3.2&sensor=false&language=th&callback=initialize"
        }).appendTo("body");
    });
    //-----------------------------------------------Google Map------------------------------------//

    var postID = @ViewBag.PostBuildingID;
    var postBuildingDetail;
    $(document).ready(function () {
        //-----------------------Initial-----------------------//
        if ('@ViewBag.Owner' == '0')
        {
            window.location.href = "@Url.Action("Post", "Home", new { area = string.Empty })";
        }
        $.cookie.defaults = { path: '/' };
        var auid = $.cookie('auid');        
        if (auid == null) {
            window.location.href = "@Url.Action("Post", "Home", new { area = string.Empty })";
        }
        /////TODO
        $("#pnPostHeade").show();
        //$("#pnPostMap").hide();
        $("#pnPostDetail").hide();
        $("#pnPostImage").hide();
        $("#pnPostCommit").hide();
        $.ajax({
            type: "GET",
            url: "@Url.Action("getInitDataNewPost", "Home", new { area = string.Empty })",
            dataType: "json",
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                DataInit = data;
                
                $("#cbBuilding").val(data.mdPost.BuildingTypeID);
                $("#cbPostType").val(data.mdPost.PostTypeID);
                $("#Price").val(data.mdPost.SalePrice);
                $("#PostTitle").val(data.mdPost.PostTitle);
                $("#Description").val(data.mdPost.Description);
                $("#cbProvince").val(data.mdPost.ProvinceID);
                $("#cbDistrict").val(data.mdPost.DistrictID);
                $("#cbSubDistrict").val(data.mdPost.SubDistrictID);
                $("#RoadName").val(data.mdPost.RoadName);
                $("#AddressNo").val(data.mdPost.AddressNo);


                //----------------------Set Post Type
                $("#cbPostType option").remove();
                $("#cbPostType").append('<option value="">--กรุณาเลือก--</option>');
                for (var i = 0; i < data.mdPostType.length; i++) {
                    $("#cbPostType").append('<option value=' + data.mdPostType[i].PostTypeID + '>' + data.mdPostType[i].PostTypeName + '</option>');
                }
                //----------------------Set Building Type
                $("#cbBuilding option").remove();
                $("#cbBuilding").append('<option value="">--กรุณาเลือก--</option>');
                for (var i = 0; i < data.mdBuildingType.length; i++) {
                    $("#cbBuilding").append('<option value=' + data.mdBuildingType[i].BuildingTypeID + '>' + data.mdBuildingType[i].BuildingTypeName + '</option>');
                }
                //----------------------Set Area
                $("#cbProvince option").remove();
                $("#cbProvince optgroup").remove();
                $("#cbProvince").append('<option value="">--กรุณาเลือก--</option>');
                for (var i = 0; i < data.mdProvinceGroup.length; i++) {
                    $("#cbProvince").append('<optgroup style="" id="aG' + data.mdProvinceGroup[i].ProvinceGroupID + '" label="' + data.mdProvinceGroup[i].ProvinceGroupName + '"></optgroup>');
                    for (var j = 0; j < data.mdProvince.length; j++) {
                        if (data.mdProvince[j].ProvinceGroupID == data.mdProvinceGroup[i].ProvinceGroupID)
                            $('#aG' + data.mdProvinceGroup[i].ProvinceGroupID).append('<option  value=' + data.mdProvince[j].ProvinceID + '>' + data.mdProvince[j].ProvinceName + '</option>');
                    }
                }
            } //success
        });
        $("#Price").change(function () {

            var n = parseInt($("#Price").val().replace(/\,/g, ''));
            if (isNaN(n)) $("#Price").val(0);
            else $("#Price").val(numberWithCommas(n));
        });
        $("#cbProvince").change(function () {
            getDistrict($("#cbProvince").val());
            $("#namePlace").val('ประเทศไทย ' + $("#cbProvince option:selected").text());
            searchPlace();
        });
        $("#cbDistrict").change(function () {
            getSubDistrict($("#cbDistrict").val());

            $("#namePlace").val('ประเทศไทย ' + $("#cbProvince option:selected").text() + ' ' + $("#cbDistrict option:selected").text());
            searchPlace();
        });
        $("#cbSubDistrict").change(function () {
            $("#namePlace").val('ประเทศไทย ' + $("#cbProvince option:selected").text() + ' ' + $("#cbDistrict option:selected").text() + ' ' + $("#cbSubDistrict option:selected").text());
            searchPlace();
        });
        $("#cbBuilding").change(function () {
            setPostBuildingDetail();
        });
        getDistrict(0);
        getSubDistrict(0);
    });
    function intValueChange(textbox) {//textbox.id
        var n = parseInt($("#" + textbox.id).val().replace(/\,/g, ''));
        if (isNaN(n)) $("#" + textbox.id).val(0);
        else $("#" + textbox.id).val(numberWithCommas(n));
    }
    function  numberValueChange(textbox) {
        var n = parseFloat($("#"+textbox.id).val().replace(/\,/g, ''));
        if (isNaN(n)) $("#" + textbox.id).val(0);
        else $("#" + textbox.id).val(numberWithCommas(n));
    }
    function getDistrict(id) {
        var data = DataInit;
        $("#cbDistrict option").remove();
        $("#cbDistrict").append('<option value="">--กรุณาเลือก--</option>');
        if (data != null && data.mdDistrict != null) {
            for (var i = 0; i < data.mdDistrict.length; i++) {
                if (data.mdDistrict[i].ProvinceID == id)
                    $("#cbDistrict").append('<option value=' + data.mdDistrict[i].DistrictID + '>' + data.mdDistrict[i].DistrictName + '</option>');
            }
        }
    }
    function getSubDistrict(id) {
        var data = DataInit;
        $("#cbSubDistrict option").remove();
        $("#cbSubDistrict").append('<option value="">--กรุณาเลือก--</option>');
        if (data != null && data.mdSubDistrict != null) {
            for (var i = 0; i < data.mdSubDistrict.length; i++) {
                if (data.mdSubDistrict[i].DistrictID == id)
                    $("#cbSubDistrict").append('<option value=' + data.mdSubDistrict[i].SubDistrictID + '>' + data.mdSubDistrict[i].SubDistrictName + '</option>');
            }
        }
    }
    function numberWithCommas(x) {
        return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }
    function setPostBuildingDetail() {
        if (!isNaN($("#cbBuilding").val()) && $("#cbBuilding").val() != null) {
            $.ajax({
                type: "GET",
                url: "@Url.Action("getPostBuildingDetail", "Home", new { area = string.Empty })",
                data: { BuildingTypeID: $("#cbBuilding").val(), PostBuildingID: 0 },
                dataType: "json",
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    postBuildingDetail= data;
                    $("#pnDetail div").remove();

                    for (var i = 0; i < data.mdPostGroupDetail.length; i++)
                    {
                        $("#pnDetail").append('<div class="col-md-12" style="margin-top: 15px;">' + data.mdPostGroupDetail[i].BuildingGroupDetailName
                            + '</div><div class="col-md-12"><hr style="margin-top: 0px;margin-bottom:10px"/></div>');
                        for (var j = 0; j < data.mdPostDetail.length; j++)
                        {
                            if (data.mdPostGroupDetail[i].BuildingGroupDetailID == data.mdPostDetail[j].BuildingGroupDetailID)
                            {
                                switch(data.mdPostDetail[j].DetailControlType  ) {
                                    case 'TextBox':
                                        $("#pnDetail").append('<div class="row"><div  class="col-sm-12"><label for="PostTitle" class="col-sm-2 control-label text-right">' + data.mdPostDetail[j].DetailName + '</label>'
                                            + '<div class="col-sm-' + data.mdPostDetail[j].ColWidth + '"><input type="text" class="form-control  input-sm" id="tb_' + data.mdPostDetail[j].BuildingDetailID + '" value="'+data.mdPostDetail[j].PostBuildingDetailValue+'" placeholder="' + data.mdPostDetail[j].Placeholder + '"></div></div></div>');
                                        break;
                                    case 'ComboBox':
                                        $("#pnDetail").append('');
                                        break;
                                    case 'CheckBox':
                                        var checkvalue = '';if(data.mdPostDetail[j].PostBuildingDetailValue == 'true') checkvalue='checked';
                                        $("#pnDetail").append('<div class="col-sm-offset-1 col-sm-2"><div class="checkbox"><label><input type="checkbox"id="chk_' + data.mdPostDetail[j].BuildingDetailID + '" '+checkvalue+'> ' + data.mdPostDetail[j].DetailName + '</label></div></div>');
                                        break;
                                    case 'Int':
                                        $("#pnDetail").append('<div class="row"><div  class="col-sm-12">'
                                                                + '    <label for="tb_' + data.mdPostDetail[j].BuildingDetailID + '" class="col-sm-2 control-label text-right">' + data.mdPostDetail[j].DetailName + '</label>'
                                                                + '    <div class="col-sm-' + data.mdPostDetail[j].ColWidth + '">'
                                                                + '        <div class="input-group">'
                                                                + '            <input type="text" class="form-control " onchange="intValueChange(this);" id="tb_' + data.mdPostDetail[j].BuildingDetailID + '"  value="'+data.mdPostDetail[j].PostBuildingDetailValue+'" placeholder="' + data.mdPostDetail[j].Placeholder + '">'
                                                                + '            <span class="input-group-addon">' + data.mdPostDetail[j].UnitName + '</span>'
                                                                + '        </div>'
                                                                + '    </div>'
                                                                + '</div></div>');

                                        break;
                                    case 'Number':
                                        $("#pnDetail").append('<div class="row"><div  class="col-sm-12">'
                                                               + '    <label for="tb_' + data.mdPostDetail[j].BuildingDetailID + '" class="col-sm-2 control-label text-right">' + data.mdPostDetail[j].DetailName + '</label>'
                                                               + '    <div class="col-sm-' + data.mdPostDetail[j].ColWidth + '">'
                                                               + '        <div class="input-group">'
                                                               + '            <input type="text" class="form-control " onchange="numberValueChange(this);" id="tb_' + data.mdPostDetail[j].BuildingDetailID + '"  value="'+data.mdPostDetail[j].PostBuildingDetailValue+'" placeholder="' + data.mdPostDetail[j].Placeholder + '">'
                                                               + '            <span class="input-group-addon">' + data.mdPostDetail[j].UnitName + '</span>'
                                                               + '        </div>'
                                                               + '    </div>'
                                                               + '</div></div>');
                                        break;
                                }
                            }
                        }
                    }
                } //success BuildingTypeID, int PostBuildingID
            });
        }
    }
</script>

<section class="content-header">
    <h1>
        ขั้นตอน-ลงประกาศ
    </h1>
    <ol class="breadcrumb">
        <li><a href="@Url.Action("Index", "Home", new { area = string.Empty })"><i class="fa fa-dashboard"></i> หน้าแรก</a></li>
        <li><a href="@Url.Action("Post", "Home", new { area = string.Empty })"><i class="fa fa-clipboard"></i> ลงประกาศ</a></li>
        <li class="active"> ขั้นตอน-ลงประกาศ</li>
    </ol>
</section>
<section class="content">  
    <div class="modal fade" id="modalMSG">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title">Message</h4>
                </div>
                <div class="modal-body" id="tbMSG">
                    
                </div>
                <div class="modal-footer">
                    <a class="btn btn-default" data-dismiss="modal">Close</a>
                    
                </div>
            </div>
        </div>
    </div>  
    <div class="row">
        <div class="col-md-12">
            <div class="box box-primary color-palette-box" id="pnPostHeade">
                <div class="box-header with-border">
                    <h3 class="box-title"><i class="fa fa-pencil-square-o"></i> ข้อมูลเบื้องต้น</h3>
                    <div class="box-tools pull-right">
                        <button type="button" class="btn btn-box-tool" data-widget="collapse">
                            <i class="fa fa-minus"></i>
                        </button>
                      
                    </div>
                </div>
                <div class="box-body">
                        <div class="box-body">
                            <div class="row">
                                <label for="cbPostType" class="col-sm-3 control-label text-right">ประกาศ *</label>
                                <div class="col-sm-9 has-error" id="pnPostType">
                                    <div class="input-group">
                                        <select class="form-control input-sm" name="cbPostType" id="cbPostType"></select>
                                        <span class="help-block">กรุณาเลือก ประกาศ</span>
                                    </div>
                                </div>
                                <script>
                                    $("#cbPostType").focusout(function() {                                       
                                        if($( "#cbPostType" ).val()==""){
                                            $( "#pnPostType" ).addClass( "has-error" );
                                            $( "#pnPostType div span" ).show();
                                        }
                                        else{
                                            $( "#pnPostType" ).removeClass( "has-error" );
                                            $( "#pnPostType div span" ).hide();
                                        }
                                    });
                                </script>
                            </div>
                            <div class="row">
                                <label for="cbBuilding" class="col-sm-3 control-label text-right">ประเภท *</label>

                                <div class="col-sm-9 has-error" id="pnBuilding">
                                    <div class="input-group">
                                        <select class="form-control  input-sm" id="cbBuilding"></select>
                                        <span class="help-block">กรุณาเลือก ประเภท</span>
                                    </div>
                                </div>
                                <script>
                                    $("#cbBuilding").focusout(function() {
                                        if($( "#cbBuilding" ).val()==""){
                                            $( "#pnBuilding" ).addClass( "has-error" );
                                            $( "#pnBuilding div span" ).show();
                                        }
                                        else{
                                            $( "#pnBuilding" ).removeClass( "has-error" );
                                            $( "#pnBuilding div span" ).hide();
                                        }
                                    });
                                </script>

                            </div>
                            <div class="col-md-12">
                                <hr>
                            </div>
                            <div class="row">
                                <label for="PostTitle" class="col-sm-3 control-label text-right">หัวข้อประกาศ *</label>

                                <div class="col-sm-5  has-error" id="pnPostTitle">
                                    <input type="text" class="form-control  input-sm" name="PostTitle" id="PostTitle" placeholder="หัวข้อประกาศ">
                                    <span class="help-block">กรุณาเพิ่มข้อมูล หัวข้อประกาศ</span>
                                </div>
                                <script>
                                    $("#PostTitle").focusout(function() {
                                        if($( "#PostTitle" ).val()==""){
                                            $( "#pnPostTitle" ).addClass( "has-error" );
                                            $( "#pnPostTitle span" ).show();
                                        }
                                        else{
                                            $( "#pnPostTitle" ).removeClass( "has-error" );
                                            $( "#pnPostTitle span" ).hide();
                                        }
                                    });
                                </script>

                            </div>
                            <div class="row">
                                <label for="Description" class="col-sm-3 control-label text-right">รายละเอียดเกี่ยวกับประกาศ</label>

                                <div class="col-sm-8">
                                    <textarea class="form-control" rows="3" name="Description" id="Description" placeholder="รายละเอียดเกี่ยวกับประกาศ"></textarea>
                                </div>
                            </div>
                            <div class="col-md-12">
                                <hr>
                            </div>
                            <div class="row">
                                <label for="Price" class="col-sm-3 control-label text-right">ราคา *</label>
                                <div class="col-sm-5  has-error" id="pnPrice">
                                    <div class="input-group">
                                        <input type="text" class="form-control text-right " id="Price" placeholder="ราคา">
                                        <span class="input-group-addon">.00</span>
                                    </div>
                                    <span class="help-block">กรุณาระบุราคา</span>
                                </div>
                                <script>
                                    $("#Price").focusout(function() {
                                        if($( "#Price" ).val()==""){
                                            $( "#pnPrice" ).removeClass( "has-warning" );
                                            $( "#pnPrice" ).addClass( "has-error" );
                                            $( "#pnPrice .help-block" ).show();
                                        }
                                        else if($( "#Price" ).val()=="0"){
                                            $( "#pnPrice" ).removeClass( "has-error" );
                                            $( "#pnPrice" ).addClass( "has-warning" );
                                            $( "#pnPrice .help-block" ).hide();
                                        }
                                        else{
                                            $( "#pnPrice" ).removeClass( "has-warning" );
                                            $( "#pnPrice" ).removeClass( "has-error" );
                                            $( "#pnPrice .help-block" ).hide();
                                        }
                                    });
                                </script>

                            </div>
                            <div class="row">
                                <label for="cbProvince" class="col-sm-3 control-label text-right">จังหวัด *</label>

                                <div class="col-sm-9 has-error" id="pnProvince">
                                    <div class="input-group">
                                        <select class="form-control" id="cbProvince"></select>
                                        <span class="help-block">กรุณาเลือกจังหวัด</span>
                                    </div>
                                </div>
                                <script>
                                    $("#cbProvince").focusout(function() {
                                        if($( "#cbProvince" ).val()==""){
                                            $( "#pnProvince" ).addClass( "has-error" );
                                            $( "#pnProvince .help-block" ).show();
                                        }
                                        else{
                                            $( "#pnProvince" ).removeClass( "has-error" );
                                            $( "#pnProvince .help-block" ).hide();
                                        }
                                    });
                                </script>

                            </div>
                            <div class="row">
                                <label for="cbDistrict" class="col-sm-3 control-label text-right">อำเภอ/เขต *</label>

                                <div class="col-sm-9 has-error" id="pnDistrict">
                                    <div class="input-group">
                                        <select class="form-control" id="cbDistrict"></select>
                                        <span class="help-block">กรุณาเลือก อำเภอ/เขต</span>
                                    </div>
                                </div>
                                <script>
                                    $("#cbDistrict").focusout(function() {
                                        if($( "#cbDistrict" ).val()==""){
                                            $( "#pnDistrict" ).addClass( "has-error" );
                                            $( "#pnDistrict .help-block" ).show();
                                        }
                                        else{
                                            $( "#pnDistrict" ).removeClass( "has-error" );
                                            $( "#pnDistrict .help-block" ).hide();
                                        }
                                    });
                                </script>

                            </div>
                            <div class="row">
                                <label for="cbSubDistrict" class="col-sm-3 control-label text-right">ตำบล/แขวง *</label>

                                <div class="col-sm-9 has-error" id="pnSubDistrict">
                                    <div class="input-group">
                                        <select class="form-control" id="cbSubDistrict"></select>
                                        <span class="help-block">กรุณาเลือก ตำบล/แขวง</span>
                                    </div>
                                </div>
                                <script>
                                    $("#cbSubDistrict").focusout(function() {
                                        if($( "#cbSubDistrict" ).val()==""){
                                            $( "#pnSubDistrict" ).addClass( "has-error" );
                                            $( "#pnSubDistrict .help-block" ).show();
                                        }
                                        else{
                                            $( "#pnSubDistrict" ).removeClass( "has-error" );
                                            $( "#pnSubDistrict .help-block" ).hide();
                                        }
                                    });
                                </script>

                            </div>
                            <div class="row">
                                <label for="RoadName" class="col-sm-3 control-label text-right"> ถนน</label>

                                <div class="col-sm-5">
                                    <input type="text" class="form-control  input-sm" id="RoadName" placeholder="ถนน">

                                </div>
                            </div>
                            <div class="row">
                                <label for="AddressNo" class="col-sm-3 control-label text-right"> ที่อยู่</label>

                                <div class="col-sm-5">
                                    <input type="text" class="form-control  input-sm" id="AddressNo" placeholder="ที่อยู่">
                                </div>
                            </div>

                        </div>
                        @*<input type="submit" />*@
                    
                    <div class="col-md-12">
                        <hr>
                    </div>
                    <!--------------------------------------ระบุพิกัด---------------------------------->
                    <div class="box-body">
                        <div id="map_canvas"></div>
                        <div id="showDD" style="margin:auto;padding-top:5px;width:550px;">
                            <!--textbox กรอกชื่อสถานที่ และปุ่มสำหรับการค้นหา เอาไว้นอกแท็ก <form>-->
                            Search Place
                            <input name="namePlace" type="text" id="namePlace" size="40" />
                            <input type="button" name="SearchPlace" id="SearchPlace" value="Search" />
                            <hr />
                            <!--  <form> เก็บข้อมูลสำหรับนำไปบันทึกลงฐานข้อมูล หรือนำไปใช้อื่นๆ-->
                            <form id="form_get_detailMap" name="form_get_detailMap" method="post" action="">
                                Latitude
                                <input name="lat_value" type="text" id="lat_value" value="0" size="17" disabled />
                                Longitude
                                <input name="lon_value" type="text" id="lon_value" value="0" size="17" disabled />
                            </form>
                        </div>
                    </div>
                </div>    
                <div class="box-footer">
                    <button type="button" class="pull-left  btn btn-default" disabled>
                        <i class="fa fa-arrow-circle-left"></i> Back
                    </button>
                    <button type="button" class="pull-right btn btn-success" onclick="HeadeNext();">
                        Next <i class="fa fa-arrow-circle-right"></i>
                    </button>
                    <script>
                        function HeadeNext() {   
                            var numItems = $('#pnPostHeade .has-error').length
                            if(numItems>0){
                                $('#tbMSG div').remove();
                                $('#tbMSG').append('<div>กรุณาตรวจสอบข้อมูล</div>');
                                $('#modalMSG').modal('show');
                            }
                            else{
                                var dat = DataInit;
                                dat.mdPost.BuildingTypeID = $("#cbBuilding").val();
                                dat.mdPost.PostTypeID = $("#cbPostType").val();
                                dat.mdPost.SalePrice = parseInt($("#Price").val().replace(/\,/g, ''));
                                dat.mdPost.PostTitle = $("#PostTitle").val();
                                dat.mdPost.Description = $("#Description").val();
                                dat.mdPost.ProvinceID = $("#cbProvince").val();
                                dat.mdPost.DistrictID = $("#cbDistrict").val();
                                dat.mdPost.SubDistrictID = $("#cbSubDistrict").val();
                                dat.mdPost.RoadName = $("#RoadName").val();
                                dat.mdPost.AddressNo = $("#AddressNo").val();
                                dat.mdPost.UserID = $("#fairygroup").data("auid");
                                dat.mdPost.LatitudeMap = parseFloat($("#lat_value").val().replace(/\,/g, ''));
                                dat.mdPost.LongitudeMap = parseFloat($("#lon_value").val().replace(/\,/g, ''));
                                if ('@ViewBag.Owner' == '1')dat.mdPost.isOwner = true;
                                else dat.mdPost.isOwner = false;
                            
                                $.ajax({
                                    type: "POST",
                                    url: "@Url.Action("SavePostHeader", "Home", new { area = string.Empty })",
                                    data: JSON.stringify(dat.mdPost),
                                    dataType: "json",
                                    contentType: "application/json; charset=utf-8",
                                    success: function (data) {
                                        postID = data.PostBuildingID
                                        DataInit.mdPost = data;
                                        var Owner =1;if(!data.isOwner)Owner=2;
                                    
                                        //ChangeUrl(''
                                        //    , window.location.origin + window.location.pathname+'?owner='+Owner+'&PostBuildingID='+data.PostBuildingID) ;
                                        //jQuery.param.querystring(window.location.href, 'owner='+Owner+'&PostBuildingID='+data.PostBuildingID);

                                        $('#pnPostHeade').hide();
                                        $('#pnPostDetail').show();
                                        $('#pnPostImage').hide();
                                        $('#pnPostCommit').hide();
                                    } //success
                                });
                            }
                        }
                        function ChangeUrl(page, url) {
                            if (typeof (history.pushState) != "undefined") {
                                var obj = { Page: page, Url: url };
                                history.pushState(obj, obj.Page, obj.Url);
                            } else {
                                alert("Browser does not support HTML5.");
                            }
                        }

                    </script>
                </div>            
            </div>
           
            <div class="box box-primary color-palette-box" id="pnPostDetail">
                <div class="box-header with-border">
                    <h3 class="box-title"><i class="fa fa-file-text-o"></i> รายละเอียด</h3>
                    <div class="box-tools pull-right">
                        <button type="button" class="btn btn-box-tool" data-widget="collapse">
                            <i class="fa fa-minus"></i>
                        </button>
                    </div>
                </div>
                <div class="box-body" id="pnDetail">

                </div>
                <div class="box-footer">
                    <button type="button" class="pull-left  btn btn-default" onclick="$('#pnPostHeade').show(); $('#pnPostDetail').hide(); $('#pnPostImage').hide(); $('#pnPostCommit').hide();">
                        <i class="fa fa-arrow-circle-left"></i> Back
                    </button>
                    <button type="button" class="pull-right btn btn-success" onclick="PostDetailNext();">
                        Next <i class="fa fa-arrow-circle-right"></i>
                    </button>
                    <script>
                        function PostDetailNext() {
                            var data = postBuildingDetail;


                            for (var j = 0; j < data.mdPostDetail.length; j++)
                            {
                                data.mdPostDetail[j].PostBuildingID = postID;
                                switch(data.mdPostDetail[j].DetailControlType  ) {
                                    case 'TextBox':
                                        data.mdPostDetail[j].PostBuildingDetailValue = $('#tb_' + data.mdPostDetail[j].BuildingDetailID ).val();
                                        break;
                                   
                                    case 'CheckBox':
                                        data.mdPostDetail[j].PostBuildingDetailValue = $('#chk_' + data.mdPostDetail[j].BuildingDetailID ).prop( "checked" ).toString()
                                        break;
                                    case 'Int':
                                        data.mdPostDetail[j].PostBuildingDetailValue = $('#tb_' + data.mdPostDetail[j].BuildingDetailID ).val();


                                        break;
                                    case 'Number':
                                        data.mdPostDetail[j].PostBuildingDetailValue = $('#tb_' + data.mdPostDetail[j].BuildingDetailID ).val();

                                        break;
                                }


                                $.ajax({
                                    type: "POST",
                                    url: "@Url.Action("SavePostDetail", "Home", new { area = string.Empty })",
                                    data: JSON.stringify(data.mdPostDetail[j]),
                                    dataType: "json",
                                    contentType: "application/json; charset=utf-8",
                                    success: function (data) {
                                        debugger
                                        $('#pnPostHeade').hide();                                        
                                        $('#pnPostDetail').hide(); 
                                        $('#pnPostImage').show(); 
                                        $('#pnPostCommit').hide();
                                    } //success
                                });
                                
                            }


                            //for(var i=0;i<dat.mdPostDetail.length;i++)
                            //{
                            //    dat.mdPostDetail[i]
                            //}
                            @*$.ajax({
                                type: "POST",
                                url: "@Url.Action("SavePostDetail", "Home", new { area = string.Empty })",
                                data: JSON.stringify(data.mdPostDetail),
                                dataType: "json",
                                contentType: "application/json; charset=utf-8",
                                success: function (data) {
                                    debugger


                                    $('#pnPostHeade').hide(); $('#pnPostMap').hide(); $('#pnPostDetail').hide(); $('#pnPostImage').show(); $('#pnPostCommit').hide();
                                } //success
                            });*@
                        }
                    </script>

                </div> 
            </div>

            <div class="box box-primary color-palette-box" id="pnPostImage">
                <div class="box-header with-border">
                    <h3 class="box-title"><i class="fa fa-image "></i> แนบรูปภาพ</h3>
                    <div class="box-tools">
                        <button type="button" class="btn btn-box-tool" data-widget="collapse">
                            <i class="fa fa-minus"></i>
                        </button>
                    </div>
                </div>
                <div class="box-body" >
                    
                    <form action="/Home/PostBuldingUpload" enctype="multipart/form-data" method="post" id="fileUploadForm">
                        <div class="form-group">
                            <label for="ImageFile" class="col-sm-2 control-label">Image:</label>
                            <div class="col-sm-6">
                                <input type="file" multiple="" name="Postfiles" id="Postfiles" accept="image/*">
                            </div>
                            <input id="btUpload2" type="button" value="Upload File" />
                        </div>
                        <div class="box-body table-responsive no-padding">
                            <table class="table table-hover" id="tbImg">
                                <tbody>
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Image</th>
                                        <th>File Name</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                        <script>
                            $(document).ready(function () {

                                $("#btUpload2").click(function () {

                                    var formData = new FormData( $('#fileUploadForm')[0]);
                                    //var idv =2;
                                    $.ajax({
                                        url: '/Home/PostBuldingUpload?id='+postID,
                                        data:formData,
                                        processData: false,
                                        type: 'POST',
                                        enctype: 'multipart/form-data',
                                        contentType: false,
                                        cache: false,
                                        success: function (data) {
                                            if(data==""){
                                                $("#Postfiles").val("");
                                                ReloadImg();
                                            }
                                            else alert(data);
                                        }
                                    });
                                });
                                //e.preventDefault();
                            });
                            function ReloadImg(){
                                $.ajax({
                                    url: '/Home/getPostBuildingByUser?id='+postID,
                                    type: 'POST',
                                    success: function (data) {
                                        $("#tbImg tbody tr").remove();
                                        for(var i = 0;i<data.length;i++)
                                        {
                                            $("#tbImg tbody").append( '<tr>'+
                                                                       '    <td>'+data[i].PostBuildingImgID+'</td>'+
                                                                       '    <td><img style="max-width:100px;max-height:100px"  src="' + data[i].PathName + data[i].FileName + '" alt="Grid"></a></td>'+
                                                                       '    <td>'+ data[i].FileName + '</td>'+
                                                                       '    <td><button type="button" class=" btn btn-xs btn-danger" onclick="DeleteImg('+data[i].PostBuildingImgID+')"><i class="fa fa-trash"></i></button></td>'+
                                                                       '</tr>');

                                        }
                                    }
                                });
                            }
                            function DeleteImg(ImgID){
                                $.ajax({
                                    url: '/Home/DeleteImg?ImgID='+ImgID,
                                    type: 'POST',
                                    success: function (data) {
                                        if(data=="")ReloadImg();
                                    else alert(data);
                                    }
                                });
                            }
                            function PostBuildingConfirm() {
                                //$('#pnPostHeade').hide(); $('#pnPostDetail').hide(); $('#pnPostImage').hide(); $('#pnPostCommit').show();
                                $.ajax({
                                    url: '/Home/PostBuldingConfirm?id='+postID,
                                    type: 'POST',
                                    success: function (data) {
                                        window.location.href = "@Url.Action("Post", "Home", new { area = string.Empty })";                                        
                                    }
                                });
                            }

                        </script>

                    </form>                   
                    
                </div>
                <div class="box-footer">
                    <button type="button" class="pull-left  btn btn-default" onclick="$('#pnPostHeade').hide(); $('#pnPostDetail').show(); $('#pnPostImage').hide(); $('#pnPostCommit').hide();">
                        <i class="fa fa-arrow-circle-left"></i> Back 
                    </button>
                    <button type="button" class="pull-right btn btn-success" onclick="PostBuildingConfirm();">
                        ลงประกาศ <i class="fa fa-arrow-circle-right"></i>
                    </button>
                </div>
            </div>
            <div class="box box-primary color-palette-box" id="pnPostCommit">
                <div class="box-header with-border">
                    <h3 class="box-title"><i class="fa fa-check-circle"></i> ยืนยันการลงประกาศ</h3>
                    <div class="box-tools pull-right">
                        <button type="button" class="btn btn-box-tool" data-widget="collapse">
                            <i class="fa fa-minus"></i>
                        </button>
                    </div>
                </div>
                <div class="box-body">
                    <div class="box-body">
                       

                    </div>
                </div>
                <div class="box-footer">
                    <button type="button" class="pull-left  btn btn-default" onclick="$('#pnPostHeade').hide(); $('#pnPostDetail').hide(); $('#pnPostImage').show(); $('#pnPostCommit').hide();">
                        <i class="fa fa-arrow-circle-left"></i> Back
                    </button>
                    <button type="button" class="pull-right btn btn-success" >
                        Post <i class="fa fa-check-circle"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
</section>
